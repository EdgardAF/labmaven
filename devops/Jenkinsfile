pipeline {
     agent any

     tools {
        maven 'maven-default'
     }

    stages {
        stage('Checking') {
            when {
                branch "features/*"
            }
            steps {
                script {
                     sh 'mvn verify'
                }
            }
            post {
                always {
                    junit(testResults: '**/surefire-reports/*.xml', allowEmptyResults: true)
                    junit(testResults: '**/failsafe-reports/*.xml', allowEmptyResults: true)
                    jacoco runAlways: true
                }
                //success {
                //    archiveArtifacts artifacts: 'target/*.jar', followSymlinks: false, onlyIfSuccessful: true
                //}
            }
        }
        stage('OtherStage') {
            when {
                branch "features/*"
            }
            steps {
                script {
                    echo 'Stage 2'
                }
            }
        }

         stage('Building') {
            when {
                branch "master"
            }
            steps {
                script {
                     sh 'mvn verify'
                }
            }
            post {
                always {
                    junit(testResults: '**/surefire-reports/*.xml', allowEmptyResults: true)
                    junit(testResults: '**/failsafe-reports/*.xml', allowEmptyResults: true)
                    jacoco runAlways: true
                }
                success {
                    archiveArtifacts artifacts: 'target/*.jar', followSymlinks: false, onlyIfSuccessful: true
                }
            }
         }

         stage('Stage 4') {
                when {
                   not {
                       branch 'master'
                   }
               }
                steps {
                    script {
                        echo 'Stage 4'
                    }
              }
         }
         stage('Stage 5') {
                steps {
                    script {
                        echo 'Stage 5'
                    }
              }
         }
    }
}
